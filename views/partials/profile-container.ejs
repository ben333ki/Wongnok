<div class="profile-container">
    <!-- Logo and Name Section -->
    <div class="logo-name">
        <div class="logo">
            <img id="profile-picture" src="<%= user.profile_picture %>" alt="<%= user.profile_name %>">
        </div>
        <div class="name-edit">
            <h2><%= user.profile_name %></h2>
            <% if (user.username === loginUser.username) { %>
                <button id="edit-profile-button">Edit</button>
        
                <!-- Edit Profile Form -->
                <form id="edit-profile-form" action="/main/user/edit-profile" method="post" style="display: none;">
                    <input type="text" name="profile_name" placeholder="New Profile Name" value="<%= user.profile_name %>" required class="input-name">
                    <button type="submit">Save</button>
                    <button type="button" id="cancel-edit">Cancel</button>
                </form>
        
                <!-- File Upload Form -->
                <form action="/change-profile-picture" method="post" enctype="multipart/form-data" class="upload-form">
                    <div class="upload-container">
                        <div class="file-upload-wrapper">
                            <input type="file" id="profile_picture" name="profile_picture" accept="image/*" required class="upload-input">
                            <label for="profile_picture" class="upload-button">Upload Profile Picture</label>
                          </div>
                        <button type="submit" class="upload-button">Upload</button>
                        <button id="logout" onclick="window.location.href='/logout'">Log Out</button>
                    </div>
                </form> 
            <% } %>
            <% if (user.username !== loginUser.username ) { %>
                <button
                id="followButton-<%= user._id %>"
                data-followed="<%= isFollowing %>"
                onclick="toggleFollow('<%= user._id %>')"
                >
                    <%= isFollowing ? 'Unfollow' : 'Follow' %>
                </button>
            
            <% } %>
        </div>
        
    </div>

    <!-- File Upload Form -->
    <!--<div id="upload-form" style="display: none;">
    <!    <form id="image-upload-form" action="/main/user/profile/upload" method="POST" enctype="multipart/form-data">
        <label for="profile-picture-upload">Upload new profile picture:</label>
        <input type="file" id="profile-picture-upload" name="profile_picture" accept="image/*" required>
        <button type="submit">Upload</button>
        <button type="button" id="cancel-upload">Cancel</button>
    </form>
    </div>-->
    <!-- Followers and Posts Section -->
    <div class="stats">
        <div class="stat">
            <span>10</span>
            <p>followers</p>
        </div>
        <div class="stat">
            <span>10</span>
            <p>posts</p>
        </div>
    </div>

    <!-- Description Section -->
    <div class="description">
        <p><%= user.user_bio || 'No bio provided.' %></p>
    </div>
</div>

<script>
    const editButton = document.getElementById('edit-profile-button');
    const editForm = document.getElementById('edit-profile-form');
    const cancelEdit = document.getElementById('cancel-edit');

    editButton.addEventListener('click', () => {
        editForm.style.display = 'block';
        editButton.style.display = 'none';
    });

    cancelEdit.addEventListener('click', () => {
        editForm.style.display = 'none';
        editButton.style.display = 'inline-block';
    });

    async function toggleFollow(userId) {
    try {
        const response = await fetch(`/main/user/profile/${userId}/toggleFollow`, { method: 'POST' });
        const data = await response.json();

        if (data.success) {
            // Select the specific button for this user
            const button = document.getElementById(`followButton-${userId}`);
            if (button) {
                button.textContent = data.isFollowing ? 'Unfollow' : 'Follow';
            } else {
                console.error('Follow button not found in the DOM');
            }
        } else {
            alert(data.message || 'Failed to toggle follow status.');
        }
    } catch (err) {
        console.error(err);
        alert('An error occurred. Please try again later.');
    }
}

</script>

