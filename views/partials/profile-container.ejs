<div class="profile-container">
    <!-- Logo and Name Section -->
    <div class="logo-name">
        <div class="logo">
            <img id="profile-picture" src="<%= user.profile_picture %>" alt="<%= user.profile_name %>">
        </div>
        <div class="name-edit">
            <h2><%= user.profile_name %></h2>
            <% if (user.username === loginUser.username ){ %>
                <form action="/change-profile-picture" method="post" enctype="multipart/form-data" class="upload-form">
                    <div class="upload-container">
                        <!-- <label for="profile_picture" class="upload-label">
                            <i class="fas fa-upload"></i> Choose a Profile Picture
                        </label> -->
                        <input type="file" id="profile_picture" name="profile_picture" accept="image/*" required class="upload-input">
                        <button type="submit" class="upload-button">Upload</button>
                        <button id="logout" onclick="window.location.href='/logout'">log out</button>
                    </div>
                </form> 
            <% } %>
            <% if (user.username !== loginUser.username ) { %>
                <button
                id="followButton-<%= user._id %>"
                data-followed="<%= isFollowing %>"
                onclick="toggleFollow('<%= user._id %>')"
                >
                    <%= isFollowing ? 'Unfollow' : 'Follow' %>
                </button>
            
            <% } %>
        </div>
    </div>

    <!-- File Upload Form -->
    <!--<div id="upload-form" style="display: none;">
    <!    <form id="image-upload-form" action="/main/user/profile/upload" method="POST" enctype="multipart/form-data">
        <label for="profile-picture-upload">Upload new profile picture:</label>
        <input type="file" id="profile-picture-upload" name="profile_picture" accept="image/*" required>
        <button type="submit">Upload</button>
        <button type="button" id="cancel-upload">Cancel</button>
    </form>
    </div>-->
    <!-- Followers and Posts Section -->
    <div class="stats">
        <div class="stat">
            <span>10</span>
            <p>followers</p>
        </div>
        <div class="stat">
            <span>10</span>
            <p>posts</p>
        </div>
    </div>

    <!-- Description Section -->
    <div class="description">
        <p><%= user.user_bio || 'No bio provided.' %></p>
    </div>
</div>

<script>
    // JavaScript for showing and hiding the upload form
    const editButton = document.getElementById('edit-button');
    const uploadForm = document.getElementById('upload-form');
    const cancelUpload = document.getElementById('cancel-upload');

    editButton.addEventListener('click', () => {
        uploadForm.style.display = 'block';
        editButton.style.display = 'none';
    });

    cancelUpload.addEventListener('click', () => {
        uploadForm.style.display = 'none';
        editButton.style.display = 'inline-block';
    });

    async function toggleFollow(userId) {
    try {
        const response = await fetch(`/main/user/profile/${userId}/toggleFollow`, { method: 'POST' });
        const data = await response.json();

        if (data.success) {
            // Select the specific button for this user
            const button = document.getElementById(`followButton-${userId}`);
            if (button) {
                button.textContent = data.isFollowing ? 'Unfollow' : 'Follow';
            } else {
                console.error('Follow button not found in the DOM');
            }
        } else {
            alert(data.message || 'Failed to toggle follow status.');
        }
    } catch (err) {
        console.error(err);
        alert('An error occurred. Please try again later.');
    }
}

</script>
