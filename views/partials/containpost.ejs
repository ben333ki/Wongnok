<div id="posts-container">
<div class="containpost">
  <% posts.forEach(post => { %>
    <div class="recipe-card">
      <a href="/main/user/post/<%= post._id %>"><img src="/uploads/<%= post.post_picture.split('\\').pop() %>" alt="<%= post.post_topic %>" class="recipe-image" /></a>
      <div class="recipe-details">
        <p><strong>Created by:</strong> <%= post.createdBy ? post.createdBy.profile_name : 'Unknown' %></p>
        <a href="/main/user/post/<%= post._id %>"><h3 class="recipe-title"><%= post.post_topic %></h3></a>
        <div class="recipe-rating">
          <label for="rating"><strong>คะแนนเฉลี่ย:</strong> <%= post.avg_score.toFixed(2) %></label>
          <span class="rating-value">จาก <%= post.ratings.length %> รีวิว</span>
        </div>
      </div>
      <!-- Assuming you are in the post view -->
      <button class="favorite-button"
          id="favoriteButton"
          data-post-id="<%= post._id %>"
          class="<%= loginUser.favorites.includes(post._id) ? 'favorite-active' : '' %>">
          ♥
      </button>
    </div>
  <% }) %>
</div>
</div>

<script>
  document.addEventListener("DOMContentLoaded", () => {
      const favoriteButtons = document.querySelectorAll(".favorite-button");

      favoriteButtons.forEach(button => {
          button.addEventListener("click", async () => {
              const postId = button.getAttribute("data-post-id");
              const isFavorite = button.classList.contains("favorite-active");

              // Send a POST request to add or remove from favorites
              const response = await fetch(`/main/post/${postId}/favorite`, {
                  method: "POST",
                  headers: {
                      "Content-Type": "application/json",
                  },
              });

              const result = await response.json();

              if (result.success) {
                  // Toggle the button class based on the response
                  button.classList.toggle("favorite-active", result.isFavorite);
              }
          });
      });
  });
</script>




